import{_ as s,o as a,c as n,V as l}from"./chunks/framework.7ae304b1.js";const p="/assets/20230625223640018.59cbfd6c.png",o="/assets/20230625223629714.9244a4f1.png",e="/assets/20230625223623277.36e13dbd.png",t="/assets/20230625215605264.287a67a0.png",c="/assets/20230625224252850.6e68be66.png",C="/assets/20230625222600476.652d06bd.png",u=JSON.parse('{"title":"Linuxå†…æ ¸ç§»æ¤","description":"","frontmatter":{"tags":"ç¬”è®°","date":"2023-06-25T00:00:00.000Z","title":"Linuxå†…æ ¸ç§»æ¤","sidebar":false},"headers":[],"relativePath":"pages/Linuxå†…æ ¸ç§»æ¤.md","filePath":"pages/Linuxå†…æ ¸ç§»æ¤.md","lastUpdated":1687704951000}'),r={name:"pages/Linuxå†…æ ¸ç§»æ¤.md"},y=l(`<h1 id="linuxå†…æ ¸ç§»æ¤" tabindex="-1">Linuxå†…æ ¸ç§»æ¤ <a class="header-anchor" href="#linuxå†…æ ¸ç§»æ¤" aria-label="Permalink to &quot;Linuxå†…æ ¸ç§»æ¤&quot;">â€‹</a></h1><h2 id="åˆ†æå†…æ ¸æºç " tabindex="-1">åˆ†æå†…æ ¸æºç  <a class="header-anchor" href="#åˆ†æå†…æ ¸æºç " aria-label="Permalink to &quot;åˆ†æå†…æ ¸æºç &quot;">â€‹</a></h2><blockquote><p>ä¸‹è½½æºç  <a href="https://st.com/content/ccc/resource/technical/sw-updater/firmware2/group0/2b/04/61/eb/4c/83/4d/3d/stm32cube_standard_a7_bsp_components_tf_a/files/SOURCES-tf-a-stm32mp1-openstlinux-5-10-dunfell-mp1-21-11-17_tar.xz/_jcr_content/translations/en.SOURCES-tf-a-stm32mp1-openstlinux-5-10-dunfell-mp1-21-11-17_tar.xz" target="_blank" rel="noreferrer">en.SOURCES-stm32mp1-openstlinux-5.10-dunfell-mp1-21-11-17_tar_v3.1.0.xz</a></p></blockquote><h3 id="é˜…è¯»-readme" tabindex="-1">é˜…è¯» README <a class="header-anchor" href="#é˜…è¯»-readme" aria-label="Permalink to &quot;é˜…è¯» README&quot;">â€‹</a></h3><blockquote><p><code>stm32mp1-openstlinux-5.10-dunfell-mp1-21-11-17/sources/arm-ostl-linux-gnueabi/linux-stm32mp-5.10.61-stm32mp-r2-r0\\README.HOW_TO.txt</code></p></blockquote><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Compilation of kernel:</span></span>
<span class="line"><span style="color:#A6ACCD;">1. Pre-requisite</span></span>
<span class="line"><span style="color:#A6ACCD;">2. Initialise cross-compilation via SDK</span></span>
<span class="line"><span style="color:#A6ACCD;">3. Prepare kernel source code</span></span>
<span class="line"><span style="color:#A6ACCD;">4. Manage the kernel source code</span></span>
<span class="line"><span style="color:#A6ACCD;">5. Configure kernel source code</span></span>
<span class="line"><span style="color:#A6ACCD;">6. Compile kernel source code</span></span>
<span class="line"><span style="color:#A6ACCD;">7. Update software on board</span></span></code></pre></div><ol><li>éœ€è¦å®‰è£…åº“ä¿¡æ¯ï¼š</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Ubuntu:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">u-boot-tools</span></span></code></pre></div><ol start="2"><li>è§£å‹å†…æ ¸æºç </li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xfJ</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">linux-5.10.61.tar.xz</span></span></code></pre></div><ol start="3"><li>è¿›å…¥å†…æ ¸æºç ç›®å½•</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">linux-5.10.61</span></span></code></pre></div><ol start="4"><li>å¯¹å†…æ ¸æºç è¿›è¡Œæ‰“è¡¥ä¸</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">ls</span><span style="color:#C3E88D;"> -1 ../</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.patch</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">patch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> $p</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span></code></pre></div><ol start="5"><li>é…ç½®è¡¥ä¸æ–‡ä»¶åˆ—è¡¨çš„ç›¸å…³ä¿¡æ¯</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH=arm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">multi_v7_defconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fragment</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.config</span></span></code></pre></div><ol start="6"><li>ç¼–è¯‘å†…æ ¸æºç </li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH=arm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vmlinux</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dtbs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">LOADADDR=</span><span style="color:#F78C6C;">0xC2000040</span></span></code></pre></div><ol start="7"><li>é‡‡ç”¨æ¨¡å—åŒ–æ–¹å¼è¿›è¡Œç¼–è¯‘</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH=arm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">modules</span></span></code></pre></div><ol start="8"><li>äº§ç”Ÿæ–‡ä»¶è·¯å¾„ï¼š <ul><li>uImageé•œåƒæ–‡ä»¶ï¼šå†…æ ¸æºç /arch/arm/boot/uImage</li><li>è®¾å¤‡æ ‘é•œåƒæ–‡ä»¶ï¼šå†…æ ¸æºç /arch/arm/boot/dts/st*.dtb</li></ul></li></ol><h3 id="å†…æ ¸ç›®å½•" tabindex="-1">å†…æ ¸ç›®å½• <a class="header-anchor" href="#å†…æ ¸ç›®å½•" aria-label="Permalink to &quot;å†…æ ¸ç›®å½•&quot;">â€‹</a></h3><ol><li>å¯¹å†…æ ¸æºç è¿›è¡Œè§£å‹</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/FSMP1A/linux-stm32mp-5.10.61-stm32mp-r2-r0</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-vxf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">linux-5.10.61.tar.xz</span></span></code></pre></div><ol start="2"><li>è¿›å…¥linuxå†…æ ¸æºç ç›®å½•ä¸‹</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">linux-5.10.61/</span></span></code></pre></div><ol start="3"><li>ç›®å½•ä»‹ç»</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">arch</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å­˜æ”¾å„ä¸ªæ¶æ„çš„å†…å®¹</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">arm/X86æ¶æ„</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">block</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å—è®¾å¤‡ç›¸å…³å†…å®¹</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">certs</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">åˆ—è¡¨ä¿¡æ¯</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">COPYING</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸æè¿°æ–‡æ¡£</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">CREDITS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸è´¡çŒ®è€…åˆ—è¡¨</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Documentation--------&gt;å†…æ ¸å¸®åŠ©æ–‡æ¡£ï¼ˆæ‰€ä»¥å†…æ ¸çš„ä¿¡æ¯éƒ½å¯ä»¥åœ¨è¿™ä¸ªå¸®åŠ©æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼‰</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">drivers</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">é©±åŠ¨ç›¸å…³ä»£ç </span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">fs</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">æ–‡ä»¶ç³»ç»Ÿç›¸å…³ä»£ç </span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">include</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸ä¸­å¤´æ–‡ä»¶ç›®å½•</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸åˆå§‹åŒ–ç›¸å…³ä»£ç </span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">ipc--------&gt;å†…æ ¸ä¸­è¿›ç¨‹é—´é€šä¿¡ç›¸å…³ä»£ç </span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Kbuild</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">Makefileä¼šè°ƒç”¨è¿™ä¸ªæ–‡ä»¶å®Œæˆå†…æ ¸ç¼–è¯‘</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Kconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ç”ŸæˆåŸºäºå›¾å½¢åŒ–èœå•ç•Œé¢ä¿¡æ¯</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">menuconfig</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">lib</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">å†…æ ¸åº“ç›¸å…³ä¿¡æ¯</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">LICENSES</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">éµå¾ªGPLåè®®</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">MAINTAINERS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸å½“å‰è´¡çŒ®è€…åˆ—è¡¨</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Makefile</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å·¥ç¨‹ç®¡ç†æ–‡ä»¶</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">scripts</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å’Œç¼–è¯‘ç›¸å…³ç›®å½•ï¼ˆshellè„šæœ¬ï¼‰</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">security--------&gt;å†…æ ¸å®‰å…¨ç›¸å…³ä»£ç </span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">tools--------&gt;å†…æ ¸æºç å·¥å…·ç›®å½•</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">crypto</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">å†…æ ¸åŠ å¯†ç®—æ³•</span></span></code></pre></div><h2 id="ç§»æ¤å†…æ ¸" tabindex="-1">ç§»æ¤å†…æ ¸ <a class="header-anchor" href="#ç§»æ¤å†…æ ¸" aria-label="Permalink to &quot;ç§»æ¤å†…æ ¸&quot;">â€‹</a></h2><h3 id="ç¼–è¯‘å†…æ ¸" tabindex="-1">ç¼–è¯‘å†…æ ¸ <a class="header-anchor" href="#ç¼–è¯‘å†…æ ¸" aria-label="Permalink to &quot;ç¼–è¯‘å†…æ ¸&quot;">â€‹</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">1.è¿›å…¥linuxå†…æ ¸æºç ç›®å½•ï¼Œé…ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œæ‰“å¼€Makefileæ–‡ä»¶ï¼Œæœç´¢ï¼šCROSS_COMPILE</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">370</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">?=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">SUBARCH</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">371</span><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">æ›´æ”¹ä¸ºï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">370</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">?=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arm</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">371</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CROSS_COMPILE</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arm-linux-gnueabihf-</span><span style="color:#A6ACCD;">                      </span></span>
<span class="line"><span style="color:#FFCB6B;">2.å¯¹å†…æ ¸æºç è¿›è¡Œæ‰“è¡¥ä¸</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">ls</span><span style="color:#C3E88D;"> -1 ../</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.patch</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">patch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> $p</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#FFCB6B;">3.é…ç½®è¡¥ä¸æ–‡ä»¶åˆ—è¡¨çš„ç›¸å…³ä¿¡æ¯</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ARCH=arm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">multi_v7_defconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fragment</span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.config</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">æˆåŠŸç°è±¡ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># configuration written to .config </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># </span></span>
<span class="line"><span style="color:#FFCB6B;">4.å› ä¸ºFSMP1Aå¼€å‘æ¿æ˜¯å‚è€ƒDK1å¹³å°è¿›è¡Œè®¾è®¡ï¼Œæ‰€ä»¥å°†DK1å…¬æ¿è®¾å¤‡æ ‘ç›¸å…³å†…å®¹ï¼Œå¤åˆ¶ä¸ºFSMP1Aè®¾å¤‡æ ‘</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">1ï¼‰è¿›å…¥linux-5.10.61/arch/arm/boot/dtsè®¾å¤‡æ ‘ç›®å½•ï¼Œå¤åˆ¶ç›¸å…³å†…å®¹</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stm32mp157a-dk1.dts</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">stm32mp157a-fsmp1a.dts</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stm32mp15xx-dkx.dtsi</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">stm32mp15xx-fsmp1x.dtsi</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">2ï¼‰è¿›å…¥linux-5.10.61/arch/arm/boot/dtsè®¾å¤‡æ ‘ç›®å½•ï¼Œæ‰“å¼€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stm32mp157a-fsmp1a.dts</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">13</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#include &quot;stm32mp15xx-fsmp1x.dtsi&quot;  --------&gt; è¿™ä¸€è¡Œä¸ºä¿®æ”¹å†…å®¹ </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">14</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">15</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">16</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">model</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HQYJ STM32MP157A-FSMP1A Discovery Board</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">--------&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">è¿™ä¸€è¡Œä¸ºä¿®æ”¹å†…å®¹</span><span style="color:#A6ACCD;">                                                     </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">17</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">compatible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hqyj,stm32mp157a-fsmp1a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hqyj,stm32mp157</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--------&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">è¿™ä¸€è¡Œä¸ºä¿®æ”¹å†…å®¹</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">3ï¼‰è¿›å…¥linux-5.10.61/arch/arm/boot/dtsè®¾å¤‡æ ‘ç›®å½•ï¼Œæ‰“å¼€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Makefile</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">1097</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">stm32mp157a-dk1.dtb</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">1098</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">stm32mp157a-fsmp1a.dtb</span><span style="color:#A6ACCD;"> \\    </span><span style="color:#C3E88D;">--------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">è¿™ä¸€è¡Œä¸ºä¿®æ”¹å†…å®¹</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#FFCB6B;">5.åœ¨å†…æ ¸æºç ç›®å½•ä¸‹ï¼Œç¼–è¯‘å†…æ ¸æºç </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> make -j4 ARCH=arm uImage vmlinux dtbs LOADADDR=0xC2000000 </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">è§£é‡Šï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">     timeï¼šæ˜¾ç¤ºç¼–è¯‘æ—¶é—´</span></span>
<span class="line"><span style="color:#A6ACCD;">     ARCH</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">armï¼šæŒ‡å®šarmæ¶æ„</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">uImageï¼šç¼–è¯‘ç”ŸæˆuImageé•œåƒæ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#FFCB6B;">vmlinuxï¼šelfå¯æ‰§è¡Œæ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">dtbsï¼šç¼–è¯‘è®¾å¤‡æ ‘</span></span>
<span class="line"><span style="color:#A6ACCD;">         LOADADDR</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0xC2000000</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ï¼šæŒ‡å®šåŠ è½½åœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">6.æˆåŠŸç°è±¡ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">OBJCOPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arch/arm/boot/zImage</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">Kernel:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arch/arm/boot/zImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ready</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">UIMAGE</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">arch/arm/boot/uImage</span></span>
<span class="line"><span style="color:#FFCB6B;">Image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Name:</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">Linux-5.10.61</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Created:</span><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">Wed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Jun</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">21</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">17</span><span style="color:#C3E88D;">:04:58</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2023</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">Image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Type:</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">ARM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Linux</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Kernel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Image</span><span style="color:#A6ACCD;"> (uncompressed) </span></span>
<span class="line"><span style="color:#FFCB6B;">Data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Size:</span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">7172008</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Bytes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7003.91</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6.84</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MiB</span></span>
<span class="line"><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Address:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">c2000000</span></span>
<span class="line"><span style="color:#FFCB6B;">Entry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Point:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">c2000000</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">Kernel:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arch/arm/boot/uImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">readyreal</span><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">5</span><span style="color:#C3E88D;">m46.234s</span></span>
<span class="line"><span style="color:#FFCB6B;">user</span><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">19</span><span style="color:#C3E88D;">m0.143s</span></span>
<span class="line"><span style="color:#FFCB6B;">sys</span><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">m3.807s</span></span></code></pre></div><h4 id="æµ‹è¯•" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•" aria-label="Permalink to &quot;æµ‹è¯•&quot;">â€‹</a></h4><p>æŠ¥é”™æ˜¾ç¤ºç½‘ç»œè®¾å¤‡ä¸å­˜åœ¨ <img src="`+p+`" alt=""></p><h3 id="ç§»æ¤ç½‘å¡é©±åŠ¨" tabindex="-1">ç§»æ¤ç½‘å¡é©±åŠ¨ <a class="header-anchor" href="#ç§»æ¤ç½‘å¡é©±åŠ¨" aria-label="Permalink to &quot;ç§»æ¤ç½‘å¡é©±åŠ¨&quot;">â€‹</a></h3><p>è®¾ç½® Ubuntu çš„ IP åœ°å€ï¼Œæ–°æ·»åŠ ä¸€ä¸ªç½‘ç»œï¼Œæ‰‹åŠ¨åˆ†é…åœ°å€</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">192.168.1.200</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#æœ¬æœºIPåœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">255.255.255.0</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#å­ç½‘æ©ç </span></span>
<span class="line"><span style="color:#FFCB6B;">192.168.1.1</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#ç½‘å…³åœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">8.8.8.8</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#DNS</span></span></code></pre></div><p>å¼€å‘æ¿è®¾ç½®é™æ€IP</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ipaddr</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.100</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#è®¾ç½®å¼€å‘æ¿çš„ IP åœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serverip</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.200</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#æŒ‡å®šæœåŠ¡å™¨ IP åœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gatewayip</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.1</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#æŒ‡å®šç½‘ç»œç½‘å…³çš„ IP åœ°å€</span></span>
<span class="line"><span style="color:#FFCB6B;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">netmask</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255.255</span><span style="color:#C3E88D;">.255.0</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#æŒ‡å®šå­ç½‘æ©ç </span></span>
<span class="line"><span style="color:#FFCB6B;">saveenv</span><span style="color:#A6ACCD;">                       </span><span style="color:#676E95;font-style:italic;">#ä¿å­˜è®¾ç½®</span></span></code></pre></div><p>æµ‹è¯•å¼€å‘æ¿ç½‘ç»œ</p><blockquote><p>åœ¨å¼€å‘æ¿ä¸Š ping æœåŠ¡å™¨çš„ IP åœ°å€</p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ping</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.200</span></span></code></pre></div><p>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼Œå³ä¸ºç»„å†…ç½‘æˆåŠŸ</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ethernet@5800a000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">device</span></span>
<span class="line"><span style="color:#FFCB6B;">host</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">alive</span></span></code></pre></div><h4 id="æµ‹è¯•-1" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•-1" aria-label="Permalink to &quot;æµ‹è¯•&quot;">â€‹</a></h4><p>æŠ¥é”™æ˜¾ç¤ºç”±çƒ­æ’æ‹”é—®é¢˜ <img src="`+o+`" alt=""></p><h3 id="è§£å†³çƒ­æ’æ‹”é—®é¢˜" tabindex="-1">è§£å†³çƒ­æ’æ‹”é—®é¢˜ <a class="header-anchor" href="#è§£å†³çƒ­æ’æ‹”é—®é¢˜" aria-label="Permalink to &quot;è§£å†³çƒ­æ’æ‹”é—®é¢˜&quot;">â€‹</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Device</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Drivers</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">---</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">Generic</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Driver</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Options</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">---</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">[*]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Support</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uevent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">helper</span><span style="color:#A6ACCD;">                                                           </span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/sbin/hotplug</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uevent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">helper</span></span></code></pre></div><h4 id="æµ‹è¯•-2" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•-2" aria-label="Permalink to &quot;æµ‹è¯•&quot;">â€‹</a></h4><p>æˆåŠŸè¿›å…¥linuxå†…æ ¸ <img src="`+e+`" alt=""></p><h2 id="ledä¾‹ç¨‹-ğŸ“£" tabindex="-1">LEDä¾‹ç¨‹ ğŸ“£ <a class="header-anchor" href="#ledä¾‹ç¨‹-ğŸ“£" aria-label="Permalink to &quot;LEDä¾‹ç¨‹  ğŸ“£&quot;">â€‹</a></h2><blockquote><p><strong>1. å†…æ ¸è£å‰ªæŒ‡çš„æ˜¯ä»€ä¹ˆ</strong> éœ€è¦æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œä¸éœ€è¦çš„æ¨¡å—ä¸è¿›è¡Œç¼–è¯‘ <strong>2. å¦‚ä½•å¯¹å†…æ ¸è¿›è¡Œè£å‰ª</strong> é€šè¿‡make menuconfigå‘½ä»¤</p></blockquote><h3 id="å›¾å½¢åŒ–ç•Œé¢ä¿¡æ¯é…ç½®" tabindex="-1">å›¾å½¢åŒ–ç•Œé¢ä¿¡æ¯é…ç½® <a class="header-anchor" href="#å›¾å½¢åŒ–ç•Œé¢ä¿¡æ¯é…ç½®" aria-label="Permalink to &quot;å›¾å½¢åŒ–ç•Œé¢ä¿¡æ¯é…ç½®&quot;">â€‹</a></h3><h3 id="é©±åŠ¨æ¨¡å—åŒ–ç¼–è¯‘" tabindex="-1">é©±åŠ¨æ¨¡å—åŒ–ç¼–è¯‘ <a class="header-anchor" href="#é©±åŠ¨æ¨¡å—åŒ–ç¼–è¯‘" aria-label="Permalink to &quot;é©±åŠ¨æ¨¡å—åŒ–ç¼–è¯‘&quot;">â€‹</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">0.åœ¨å†…æ ¸æºç ç›®å½•ä¸‹ï¼Œç¼–è¯‘å†…æ ¸æºç </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> make -j4 ARCH=arm uImage vmlinux dtbs LOADADDR=0xC2000000 </span></span>
<span class="line"><span style="color:#FFCB6B;">1.é‡‡ç”¨æ¨¡å—åŒ–æ–¹å¼è¿›è¡Œç¼–è¯‘</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">æˆåŠŸç°è±¡ï¼š</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">LD</span><span style="color:#A6ACCD;"> [M]  drivers/char/fsmp157a_led.ko</span></span>
<span class="line"><span style="color:#FFCB6B;">2.å°†linuxå†…æ ¸æºç ç¼–è¯‘ç”Ÿæˆçš„uImageé•œåƒæ–‡ä»¶å’Œè®¾å¤‡æ ‘é•œåƒæ–‡ä»¶æ‹·è´åˆ°~/tftpbootç›®å½•ä¸‹</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/FSMP1A/linux-stm32mp-5.10.61-stm32mp-r2-r0/linux-5.10.61</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arch/arm/boot/uImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/tftpboot/</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">arch/arm/boot/dts/stm32mp157a-fsmp1a.dtb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/tftpboot/</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">drivers/char/fsmp157a_led.ko</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/nfs/rootfs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">---------</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">ä»¥åŠé‡‡ç”¨æ¨¡å—åŒ–æ–¹å¼ç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ‹·è´åˆ°~/nfs/rootfs</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;">.è®¾ç½®bootcmdå‚æ•°ï¼šè‡ªå¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">FSMP1A&gt;</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootcmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tftp</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0xc2000000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uImage</span><span style="color:#A6ACCD;">\\;</span><span style="color:#C3E88D;">tftp</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0xc4000000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stm32mp157a-fsmp1a.dtb</span><span style="color:#A6ACCD;">\\;</span><span style="color:#C3E88D;">bootm</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0xc2000000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0xc4000000</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">FSMP1A&gt;</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">saveenv</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">Saving</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Environment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MMC...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Writing</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redundant</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MMC</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">OK</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">4.è®¾ç½®bootargså‚æ•°ï¼šè‡ªå¯åŠ¨å‚æ•°</span></span>
<span class="line"><span style="color:#FFCB6B;">FSMP1A&gt;</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">setenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootargs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root=/dev/nfs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nfsroot=</span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.250:/home/linux/nfs/rootfs,tcp,v4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rw</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">console=ttySTM0,115200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init=/linuxrc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ip=</span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.100</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">FSMP1A&gt;</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">saveenv</span></span>
<span class="line"><span style="color:#FFCB6B;">Saving</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Environment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MMC...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Writing</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MMC</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">OK</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">è§£é‡Šï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">    root</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/dev/nfsï¼šä½¿ç”¨nfsæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#A6ACCD;">    nfsroot</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.250:/home/linux/nfs/rootfsï¼šæŒ‚è½½çš„ipåœ°å€ä»¥åŠè·¯å¾„ï¼Œæ¯ä¸ªäººipåœ°å€ï¼Œä»¥åŠè·¯å¾„éœ€è¦ç¼–å†™è‡ªå·±è®¾ç½®ï¼ï¼ï¼</span></span>
<span class="line"><span style="color:#A6ACCD;">     ip</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.1.100ï¼šæ¿å­çš„ipåœ°å€ï¼Œæ¯ä¸ªäººipåœ°å€ï¼Œéœ€è¦ç¼–å†™è‡ªå·±è®¾ç½®ï¼ï¼ï¼</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">5.é‡å¯å¼€å‘æ¿ï¼Œè¿›å…¥è‡ªå¯åŠ¨æ¨¡å¼ï¼Œå®‰è£…ledç¯é©±åŠ¨</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@fsmp1a /</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># insmod fsmp157a_led.ko </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">æˆåŠŸç°è±¡ï¼š[94.962918]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">drivers/char/fsmp157a_led.c:demo_init:185</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">6.è¿è¡Œåº”ç”¨å±‚ç¨‹åº</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@fsmp1a /</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># ./a.out </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">æˆåŠŸç°è±¡ï¼š</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">100.453837</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">drivers/char/fsmp157a_led.c:demo_open:40</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">100.458299</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0x0</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">100.460470</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0x30</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">100.462791</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">drivers/char/fsmp157a_led.c:demo_ioctl:107</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">7.å¸è½½å¯¹åº”çš„é©±åŠ¨</span><span style="color:#A6ACCD;">    [root@fsmp1a </span><span style="color:#C3E88D;">/]#</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fsmp157a_led</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">114.686809</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">drivers/char/fsmp157a_led.c:demo_exit:206</span></span></code></pre></div><h4 id="æµ‹è¯•-3" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•-3" aria-label="Permalink to &quot;æµ‹è¯•&quot;">â€‹</a></h4><p><img src="`+t+`" alt=""></p><h2 id="ç¼–è¯‘è¿‡ç¨‹-ğŸ“£" tabindex="-1">ç¼–è¯‘è¿‡ç¨‹ ğŸ“£ <a class="header-anchor" href="#ç¼–è¯‘è¿‡ç¨‹-ğŸ“£" aria-label="Permalink to &quot;ç¼–è¯‘è¿‡ç¨‹ ğŸ“£&quot;">â€‹</a></h2><blockquote><ol><li>vmlinux</li><li>objcopy</li><li>Image</li><li>gzip</li><li>arch/arm/boot/compressed/vmlinux</li><li>objcopy</li><li>zImage</li><li>mkimage</li><li>uImage</li></ol></blockquote><p>#å¾…å­¦ä¹ </p><p>æ‰§è¡Œå‘½ä»¤</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">LOADADDR=</span><span style="color:#F78C6C;">0xC2000000</span></span></code></pre></div><p>arch/armç›®å½•ä¸‹ï¼Œæ‰“å¼€Makefileæ–‡ä»¶ï¼Œæœç´¢ï¼šuImage</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">315</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">BOOT_TARGETS</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">zImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xipImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootpImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uImage</span></span>
<span class="line"><span style="color:#FFCB6B;">323</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">BOOT_TARGETS</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vmlinux</span></span>
<span class="line"><span style="color:#FFCB6B;">324</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">Q</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">325</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">MAKE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">326</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">327</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">boot</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">328</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">MACHINE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">329</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">boot</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                                                                                             </span></span>
<span class="line"><span style="color:#FFCB6B;">330</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">$@</span></span>
<span class="line"><span style="color:#FFCB6B;">331</span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">MAKE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">boot</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MACHINE=</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">MACHINE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">boot</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;font-style:italic;">$@</span></span>
<span class="line"><span style="color:#FFCB6B;">332</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">kecho</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">  Kernel: $(boot)/$@ is ready</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><h3 id="kbuild-include" tabindex="-1">Kbuild.include <a class="header-anchor" href="#kbuild-include" aria-label="Permalink to &quot;Kbuild.include&quot;">â€‹</a></h3><p>æ‰“å¼€ Kbuild.includeæ–‡ä»¶ï¼ŒæŸ¥çœ‹ç¼–è¯‘è¿‡ç¨‹</p><p><img src="`+c+'" alt=""></p><h3 id="makefile-lib" tabindex="-1">Makefile.lib <a class="header-anchor" href="#makefile-lib" aria-label="Permalink to &quot;Makefile.lib&quot;">â€‹</a></h3><p>æ£€æŸ¥åŠ è½½åœ°å€</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">@$(check_for_multiple_loadaddr</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>callæ˜¯è°ƒç”¨å‘½ä»¤ï¼Œè°ƒç”¨if_changedå‘½ä»¤</p><ul><li>Makefile.libä¸­åŒ…å«äº†ä¸€äº›å…±ç”¨çš„ç¼–è¯‘è§„åˆ™å’Œå‡½æ•°ï¼Œç”¨äºç®€åŒ–å†…æ ¸ä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå…¶ä¸­å°±å«æœ‰ cmd_uimage</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">call</span><span style="color:#C3E88D;"> if_changed,uimage</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">æ‰§è¡Œcmd_uimage</span></span></code></pre></div><p><strong>uImageæ˜¯é€šè¿‡zImageå¾—åˆ°ï¼Œå°†zImageé€šè¿‡ mkimageè¿™ä¸ªå·¥å…·æ·»åŠ 64å­—èŠ‚å¤´éƒ¨ä¿¡æ¯</strong></p><h3 id="arch-arm-boot-makefile" tabindex="-1">arch/arm/boot/Makefile <a class="header-anchor" href="#arch-arm-boot-makefile" aria-label="Permalink to &quot;arch/arm/boot/Makefile&quot;">â€‹</a></h3><p>æ‰“å¼€ arch/arm/boot/Makefile æ–‡ä»¶ï¼Œæ‰¾åˆ°ç›®æ ‡ <img src="'+C+'" alt=""></p><p><strong>arch/arm/boot/compressed/vmlinuxé€šè¿‡objcopyå‘½ä»¤æ ¼å¼åŒ–è½¬æ¢ä¸ºzImage</strong></p>',76),D=[y];function A(i,F,d,B,m,E){return a(),n("div",null,D)}const g=s(r,[["render",A]]);export{u as __pageData,g as default};
