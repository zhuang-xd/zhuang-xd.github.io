import{_ as s,o as a,c as n,O as l}from"./chunks/framework.4afe7240.js";const d=JSON.parse('{"title":"用github_action自动部署vitepress项目","description":"","frontmatter":{"tags":"待成文","title":"用github_action自动部署vitepress项目","sidebar":false,"date":"2023-05-26T00:00:00.000Z"},"headers":[],"relativePath":"pages/用github_action自动部署vitepress项目.md","filePath":"pages/用github_action自动部署vitepress项目.md","lastUpdated":1686286819000}'),o={name:"pages/用github_action自动部署vitepress项目.md"},e=l(`<h1 id="用github-action自动部署vitepress项目" tabindex="-1">用github_action自动部署vitepress项目 <a class="header-anchor" href="#用github-action自动部署vitepress项目" aria-label="Permalink to &quot;用github_action自动部署vitepress项目&quot;">​</a></h1><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>原本是想用 <a href="https://vercel.com/dashboard" target="_blank" rel="noreferrer">Vercel</a> 的自动部署的，但没有自己的域名，生成的静态站点域名是 <code>vercel.app</code> 的，因此感觉还不如直接用 <code>github.io</code>，于是就琢磨起用 <code>github action</code> 自动部署站点，但是遇到了不少坑</p><h2 id="写workflow的配置文件" tabindex="-1">写workflow的配置文件 <a class="header-anchor" href="#写workflow的配置文件" aria-label="Permalink to &quot;写workflow的配置文件&quot;">​</a></h2><p>相当于一个linux云服务器，可以使用别人写好的配置文件，可以在项目添加</p><p>以下是我的配置文件 <code>.github\\workflows\\deploy.yml</code></p><div class="language-YAML"><button title="Copy Code" class="copy"></button><span class="lang">YAML</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build and deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">master</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">workflow_dispatch</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">Build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Use Node.js</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/setup-node@v1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">node-version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">16</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Install dependencies</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build VitePress site</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm run docs:build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deploy Github Pages</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JamesIves/github-pages-deploy-action@releases/v4</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.ACCESS_TOKEN }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">folder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">branch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gh-pages</span></span></code></pre></div><h2 id="授予workflow自动部署的权限" tabindex="-1">授予workflow自动部署的权限 <a class="header-anchor" href="#授予workflow自动部署的权限" aria-label="Permalink to &quot;授予workflow自动部署的权限&quot;">​</a></h2><p>配置文件中的</p><div class="language-YAML"><button title="Copy Code" class="copy"></button><span class="lang">YAML</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.ACCESS_TOKEN }}</span></span></code></pre></div><p><code>ACCESS_TOKEN</code> 就是授予wrokflow权限，配置步骤如下:</p><h3 id="一、创建-github-token" tabindex="-1">一、创建 github token <a class="header-anchor" href="#一、创建-github-token" aria-label="Permalink to &quot;一、创建 github token&quot;">​</a></h3><ol><li>登录GitHub账号</li><li>点击右上角头像，选择Settings</li><li>在左侧菜单中选择Developer settings</li><li>选择Personal access tokens</li><li>点击Generate new token</li><li>输入Token description，选择需要的权限</li><li>点击Generate token</li><li>复制生成的token，保存好备用</li></ol><h3 id="二、创建项目中的-secret" tabindex="-1">二、创建项目中的 secret <a class="header-anchor" href="#二、创建项目中的-secret" aria-label="Permalink to &quot;二、创建项目中的 secret&quot;">​</a></h3><p>setting -&gt; Secrets and varibles -&gt; Actions -&gt; New repository secret</p><ul><li>name： 随便取</li><li>value： <code>github token</code></li></ul><h3 id="三、自动执行脚本" tabindex="-1">三、自动执行脚本 <a class="header-anchor" href="#三、自动执行脚本" aria-label="Permalink to &quot;三、自动执行脚本&quot;">​</a></h3><p>windows下通过任务计划程序 + 编写 <code>deploy.bat</code> 批处理，实现每小时自动push</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">d:/blog</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-A</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">commit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--date=now</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">deploy</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">push</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git@github.com:zhuang-xd/zhuang-xd.github.io.git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">master</span></span></code></pre></div><p>注：以 <code>SYSTEM</code> 的用户账户去执行，就会只在后台运行cmd了</p><h3 id="四、其他问题" tabindex="-1">四、其他问题 <a class="header-anchor" href="#四、其他问题" aria-label="Permalink to &quot;四、其他问题&quot;">​</a></h3><p>自动部署的时候可能还是会遇到如下问题，同样是权限的问题，这里是<a href="https://blog.csdn.net/ibigboy/article/details/126402267" target="_blank" rel="noreferrer">解决方法</a></p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ol><li><a href="https://juejin.cn/post/6937532951223599141#heading-6" target="_blank" rel="noreferrer">用GitHub Action + VuePress自动化部署自己的文档网站</a></li><li><a href="https://juejin.cn/post/7168799961939722277" target="_blank" rel="noreferrer">vitepress+github actions搭建全自动部署高性能SSG网站</a></li><li><a href="https://blog.csdn.net/lvshuocool/article/details/106352024" target="_blank" rel="noreferrer">windows计划任务后台运行，去掉cmd的黑窗口</a></li></ol>`,24),p=[e];function t(r,c,i,y,D,C){return a(),n("div",null,p)}const h=s(o,[["render",t]]);export{d as __pageData,h as default};
